pipeline {
    agent any

    // You can schedule this to run periodically, e.g., once a month
    // triggers { cron('0 0 1 * *') }

    environment {
        DYNU_CREDENTIALS_ID = 'dynu_api'
    }

    stages {
        stage('Request/Renew SSL Certificate') {
            steps {
                withCredentials([string(credentialsId: env.DYNU_CREDENTIALS_ID, variable: 'DYNU_API_KEY')]) {
                    script {
                        echo 'Running Ansible playbook to request/renew SSL certificate...'
                        sh 'ansible-playbook -i inventory.ini certbot.yml'
                    }
                }
            }
        }
    }
}
